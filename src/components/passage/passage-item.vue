<template>
  <div
    :class="'passage-item' + (item.isView ? ' viewed' : '')"
    @click="gotoPost(item)"
  >
    <div class="item-top">
      <span class="username">{{ item.username }}</span>
      <span>|</span>
      <span>{{ passTime }}</span>
      <span v-text="item.type" :class="item.type == '文章' ? 'type-passage' : 'type-topic'"></span>
    </div>

    <div class="item-main">
      <h4 class="title" v-html="highlight(item.title)"></h4>
      <p class="discription" v-html="highlight(item.discription)"></p>
    </div>
    <div class="item-bottom">
      <span class="iconfont icon-view"> {{ " " + (item.view || 0) }}</span>
      <span class="iconfont icon-31dianzan">
        {{ " " + (item.dianzan || 0) }}</span
      >
      <span class="iconfont icon-pinglun">
        {{ " " + (item.comment || 0) }}</span
      >
    </div>
  </div>
</template>

<script>
import { getNumberOfDays } from "@/utils/index";
export default {
  name: "passageItem",
  props: {
    item: {
      type: Object,
      default: {
        id: "",
        username: "xxx",
        userImage: "",
        publishImage: "",
        publishTime: "",
        title: "",
        discription: "",
        view: "",
        dianzan: "",
        comment: "",
        isview: false,
      },
    },
  },
  computed: {
    passTime() {
      return getNumberOfDays(this.item.publishTime);
    },
    keyword() {
      return this.$route.query.query || "";
    },
  },
  methods: {
    // 添加高亮
    highlight(str) {
      const arr = str.split(this.keyword);
      return arr.join(`<span style="color: red;">${this.keyword}</span>`);
    },

    // 跳转到文章详情
    gotoPost(item) {
      if (item.type == "文章") {
        this.$router.push({
          name: "post",
          params: {
            ...item,
          },
        });
      }else{
        this.$router.push({
          name: "topic",
          params: {
            ...item,
          },
        });
      }
    },
  },
};
</script>

<style scoped lang='scss'>
.passage-item {
  padding: 20px 0;
  border-bottom: 1px solid #ddd9d9;
  cursor: pointer;
  font-size: 14px;

  .item-top,
  .item-bottom {
    margin-bottom: 5px;
    color: #71777c;

    .username {
      color: #2f3133;
    }

    span {
      padding-right: 10px;
    }

    .type-topic{
      color: var(--bgc-clr2);
    }

    .type-passage{
      color: var(--pink-1);
    }
  }

  .item-main {
    margin-bottom: 10px;

    .title {
      font-size: 18px;
      margin-bottom: 10px;
    }

    .discription {
      color: #86909c;
      line-height: 23px;
      max-height: 50px;
      // 多行文字超出
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
  }

  .item-bottom {
    color: #2f3133;

    .iconfont {
      font-size: 14px;
    }
  }
}

.passage-item:hover {
  background-color: #f8f8f8;
}
</style>